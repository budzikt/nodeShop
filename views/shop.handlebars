<style>
.img-greyscale {
    -webkit-filter: grayscale(100%);
    filter: grayscale(100%);
    opacity: 0.5;
}
</style>

<script type="text/javascript">

//Pass product ID to modal
$(document).on("click", "div .panel-body", function (e) {
    if($(e.target).hasClass("comment-button")){
        var dbId = e.target.attributes['dbid'].value;
        var name = $(".itemName", this).text();
        $('#modalTextId').append("Dodaj komentarz dla produktu: " + name);
        $("#commentSubmit").attr("dbId", dbId) //[todo]:ugly
    }
    else{

    }
});

//Send xhr to server
$(document).on("click", ".send-comment", function(e){
    //Bulid XHR data
    var txt = $("#comment").val();  
    var rating = $("#rating").val();
    var idDb = $("#commentSubmit").attr("dbId");
    var email = $("#email").val();
    var postPath = "/commentary/" + idDb;

    $.post(postPath, {commentText: txt, rate: rating, mail: email}, function(result){
        //Claer modal
        $('#modalTextId').empty();
        $('#email').val('');
        $('#comment').val('');
        $("#commentSubmit").attr("dbId", "") //[todo]:ugly
        $('#rating').val('')
        //Update comment number
        var selector = "#"+ idDb
        var elements = $('span.badge');
        if(elements.length === 0){
            console.log("No span")
        }
        else{
            for(i=0;i<elements.length;i++){
                if($(elements[i]).attr("dbId") === idDb){
                    console.log("MATCH")
                    $(elements[i]).text(result.comments.length)
                    break;
                }
            }
        }
        $('#myModal').modal('hide');

    }, 'json');
});

//Clear modal data
$(document).on("click", ".modal-header .close", function(e){
    //console.log("closed");
    $('#modalTextId').empty();
    $('#email').val('');
    $('#comment').val('');
    $("#commentSubmit").attr("dbId", "") //[todo]:ugly
    $('#rating').val('')
    $('#myModal').modal('hide');
})

function clearModal(){
    
}

</script>

{{>topMenu}}
{{>itemsList}}